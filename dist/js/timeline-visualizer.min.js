!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).TimelineVisualizer=e()}}((function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){return i(t[o][1][e]||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});e("tslib").__exportStar(e("./lib/timelineVisualizer"),n)},{"./lib/timelineVisualizer":2,tslib:33}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimelineVisualizer=void 0;const r=e("lodash.isequal"),i=e("superfly-timeline"),s=e("events"),o="Calibri",a="white";class l extends s.EventEmitter{constructor(e,t={}){super(),this.stepSize=1,this._layerLabelWidthProportionOfCanvas=.25,this._layerLabels={},this._timelineState={},this._hoveredObjectMap={},this._viewStartTime=0,this._mouseDown=!1,this._timelineZoom=100,this._playHeadPlaying=!1,this._playSpeed=1,this._playHeadTime=0,this._updateDrawLastTime=0,this._lastHoverAction=1,this._lastHoveredHash="",this._timelineResolveAuto=!1,this._timelineResolveStart=0,this._timelineResolveEnd=0,this._timelineResolveZoom=1,this._timelineResolveCount=100,this._timelineResolveCountAdjust=1,this._timelineResolveExpand=3,this.latestUpdateTime=0,this.reresolveTimeout=null,this._mergeIterator=0,this._canvasId=e,this.initCanvas(),this._drawPlayhead=!!t.drawPlayhead,this._layerLabelWidth=this._canvasWidth*this._layerLabelWidthProportionOfCanvas,this._viewDrawX=this._layerLabelWidth,this._viewDrawWidth=this._canvasWidth-this._layerLabelWidth,this.drawBackground(),this.drawPlayhead(),this.updateDraw()}initCanvas(){if(this._canvasContainer=document.getElementById(this._canvasId),!this._canvasContainer)throw new Error(`Canvas "${this._canvasId}" not found`);this._canvas=this._canvasContainer.getContext("2d"),this._canvasContainer.addEventListener("mousedown",(e=>this.canvasMouseDown(e))),this._canvasContainer.addEventListener("mouseup",(e=>this.canvasMouseUp(e))),this._canvasContainer.addEventListener("mousemove",(e=>this.canvasMouseMove(e))),this._canvasContainer.addEventListener("wheel",(e=>this.canvasScrollWheel(e))),this._canvasWidth=this._canvasContainer.width,this._canvasHeight=this._canvasContainer.height}updateTimeline(e,t){void 0===t&&(t={time:0,limitCount:10}),this.latestTimeline=e,this.latestOptions=t,t.limitTime?this._timelineResolveAuto=!1:this._timelineResolveAuto=!0;const n=Object.assign({},t);this._timelineResolveAuto&&this.updateTimelineResolveWindow(),void 0===this._resolvedTimeline&&(void 0!==n.time&&(this._viewStartTime=n.time),this._playHeadTime=this._viewStartTime),this._updateTimeline(!0)}_updateTimeline(e=!1){const t=Object.assign({},this.latestOptions);this._timelineResolveAuto&&(t.time=this._timelineResolveStart,t.limitTime=this._timelineResolveEnd,t.limitCount=Math.ceil(this._timelineResolveCount*this._timelineResolveCountAdjust)),this._drawPlayhead&&this._playHeadTime>t.time&&(t.time=this._playHeadTime);const n=Date.now(),r=(0,i.resolveTimeline)(this.latestTimeline,t);void 0===this._resolvedTimeline?this._resolvedTimeline=r:this._drawPlayhead?r&&(this._resolvedTimeline=this.mergeTimelineObjects(this._resolvedTimeline,r,e)):this._resolvedTimeline=r,this.updateLayerLabels(),this.latestUpdateTime=Date.now()-n,this.redrawTimeline(),this.latestUpdateTime=Date.now()-n}setViewPort(e){let t=!1;if(void 0!==e.zoom&&(this._timelineZoom=e.zoom,t=!0),void 0!==e.timestamp&&e.timestamp>0&&(this._viewStartTime=e.timestamp,t=!0),void 0!==e.playViewPort&&(this._playViewPort=e.playViewPort),void 0!==e.playSpeed){if(!this._drawPlayhead)throw new Error("setViewPort: viewPort.playSpeed was set, but drawPlayhead was not set in constructor");this._playSpeed=e.playSpeed}if(void 0!==e.playPlayhead){if(!this._drawPlayhead)throw new Error("setViewPort: viewPort.playPlayhead was set, but drawPlayhead was not set in constructor");this._playHeadPlaying=e.playPlayhead}if(void 0!==e.playheadTime){if(!this._drawPlayhead)throw new Error("setViewPort: viewPort.playheadTime was set, but drawPlayhead was not set in constructor");this._playHeadTime=Math.max(0,e.playheadTime),this._playHeadTime>0&&(this._updateDrawLastTime=this._playHeadTime),t=!0}!0===t&&this.redrawTimeline()}getHoveredObject(){return this._hoveredOver}calculateRowHeight(e){return Math.min(60,this._canvasHeight/Object.keys(e).length)}updateLayerLabels(){const e=this.getLayersToDraw();r(this._layerLabels,e.layers)||(this._layerLabels=e.layers,this._rowHeight=this.calculateRowHeight(this._layerLabels),this._timelineObjectHeight=1*this._rowHeight,this._numberOfLayers=Object.keys(this._layerLabels).length,this._rowsTotalHeight=this._rowHeight*this._numberOfLayers)}getLayers(){const e=Object.keys(this._layerLabels);return e.sort(((e,t)=>e.localeCompare(t))),e}drawLayerLabels(){let e=0;for(let t of this.getLayers())this._canvas.fillStyle="#666666",this._canvas.fillRect(0,e*this._rowHeight,this._layerLabelWidth,this._rowHeight),this._canvas.fillStyle=a,this._canvas.font=16..toString()+"px "+o,this._canvas.textBaseline="middle",this._canvas.fillText(t,0,e*this._rowHeight+this._rowHeight/2,this._layerLabelWidth),0!==this._layerLabels[t]&&(this._canvas.fillStyle="black",this._canvas.fillRect(this._layerLabelWidth,e*this._rowHeight,this._viewDrawWidth,1)),e++}drawBackground(){this._canvas.fillStyle="#333333",this._canvas.fillRect(0,0,this._canvasWidth,this._canvasHeight),this.drawBackgroundRuler()}drawBackgroundRuler(){const e=this.viewRange,t=this.viewEndTime,n=Math.pow(10,Math.floor(Math.log10(e/5))),r=10*n,i=Math.floor(e/n),s=n,o=Math.floor(this._viewStartTime/n)*n,a=Math.min(1,5/i);if(s){this._canvas.strokeStyle="#999999",this._canvas.lineWidth=1;for(let e=o;e<t;e+=s){this._canvas.beginPath();let t=this.timeToXCoord(e),n=e/r%1;n>.5&&(n-=1),n=Math.abs(n),this._canvas.globalAlpha=n<.01?1:a,t>=this._viewDrawX&&(this._canvas.moveTo(t,0),this._canvas.lineTo(t,this._canvasHeight)),this._canvas.stroke()}this._canvas.globalAlpha=1}}drawPlayhead(){this._drawPlayhead&&this.istimeInView(this._playHeadTime)&&(this._canvas.fillStyle="rgba(255, 0, 0, 0.5)",this._canvas.fillRect(this.timeToXCoord(this._playHeadTime),0,5,this._canvasHeight))}getLayersToDraw(){this._hoveredObjectMap={};const e=this._resolvedTimeline?Object.keys(this._resolvedTimeline.layers):[];e.sort(((e,t)=>e>t||e<t?1:0));const t={};return e.forEach(((e,n)=>{t[e]=n,this._hoveredObjectMap[e]=[]})),{layers:t,layersArray:e}}redrawTimeline(){this._canvas.clearRect(0,0,this._canvasWidth,this._canvasHeight),this.drawBackground(),this.drawLayerLabels(),this._timelineState=this.getTimelineDrawState(this._resolvedTimeline),this.drawTimelineState(this._timelineState),this.drawPlayhead(),this.checkAutomaticReresolve()}drawTimelineState(e){for(let t in e){const n=e[t];n.visible&&(this._canvas.fillStyle="rgb(22, 102, 247, 0.75)",this._canvas.fillRect(n.left,n.top,n.width,n.height),this._canvas.strokeStyle="rgba(232, 240, 255, 0.85)",this._canvas.lineWidth=1,this._canvas.strokeRect(n.left,n.top,n.width,n.height),this._canvas.fillStyle=a,this._canvas.font=16..toString()+"px "+o,this._canvas.textBaseline="top",this._canvas.fillText(n.title,n.left,n.top))}}getTimelineDrawState(e){let t={};if(e)for(let n in e.objects){let r=e.objects[n];for(let e=0;e<r.resolved.instances.length;e++){let i=r.resolved.instances[e],s="timelineObject:"+n+":"+i.id;t[s]=this.createStateForObject(r,i.start,i.end),!0===t[s].visible&&(this._hoveredObjectMap[r.layer+""]||(this._hoveredObjectMap[r.layer+""]=[]),this._hoveredObjectMap[r.layer+""].push({startX:t[s].left,endX:t[s].left+t[s].width,objectRefId:n,instanceId:i.id,type:"timelineObject",name:s}))}}return t}createStateForObject(e,t,n){let r={height:0,left:0,top:0,width:0,visible:!1,title:"N/A"};if(this.showOnTimeline(t,n)){let i=this.getObjectWidth(t,n),s=this.capXcoordToView(this.timeToXCoord(t)),o=this.getObjectOffsetFromTop(e.layer+"");r.height=this._timelineObjectHeight,r.left=s,r.top=o,r.width=i,r.visible=!0,r.title=e.id}return r}getObjectWidth(e,t){if(!t)return this._canvasWidth;return e<this._viewStartTime&&(e=this._viewStartTime),(t-e)*this.pixelsWidthPerUnitTime}showOnTimeline(e,t){let n=e>=this.viewEndTime,r=(t||1/0)<=this._viewStartTime;return!n&&!r}getObjectOffsetFromTop(e){return this._layerLabels[e]*this._rowHeight}updateDraw(){const e=Date.now(),t=(this._updateDrawLastTime>0?e-this._updateDrawLastTime:1)/1e3;this._updateDrawLastTime=e;const n=this._playSpeed*t;let r=!1;this._playHeadPlaying&&this._drawPlayhead&&(this._playViewPort&&this.istimeInView(this._playHeadTime)&&(this._viewStartTime+=n),this._playHeadTime+=n,r=!0),r&&this.redrawTimeline(),window.requestAnimationFrame((()=>this.updateDraw()))}canvasMouseDown(e){this._mouseDown=!0,this._mouseLastX=e.clientX,e.preventDefault(),e.stopPropagation()}canvasMouseUp(e){this._mouseDown=!1,this._lastScrollDirection=0,e.preventDefault(),e.stopPropagation()}canvasMouseMove(e){if(this._mouseDown){if(void 0===this._lastScrollDirection||0===this._lastScrollDirection){this._mouseLastX=e.clientX;let t=e.clientX-this._mouseLastX;this._lastScrollDirection=t<0?-1:1,this.canvasScrollByDeltaX(-t)}else{let t=this._mouseLastX-e.clientX;if(t<0&&1===this._lastScrollDirection)this._mouseLastX=e.clientX,this._lastScrollDirection=-1;else if(t>0&&-1===this._lastScrollDirection)this._mouseLastX=e.clientX,this._lastScrollDirection=1;else{let t=e.clientX-this._mouseLastX;this._mouseLastX=e.clientX,this.canvasScrollByDeltaX(-t)}}this.redrawTimeline()}else{let t=!1,n=this.getMousePos(this._canvasContainer,e);if(n.x>this._viewDrawX&&n.y<this._rowsTotalHeight){let e,r=Math.floor(n.y/this._rowsTotalHeight*this._numberOfLayers);Object.keys(this._layerLabels).forEach((t=>{this._layerLabels[t]===r&&(e=t)})),((e?this._hoveredObjectMap[e]:[])||[]).forEach((e=>{if(e.startX<=n.x&&e.endX>=n.x){t=!0;const r=e.type+e.objectRefId+e.instanceId;if(this._lastHoveredHash!==r&&"timelineObject"===e.type&&this._resolvedTimeline){let t=this._resolvedTimeline.objects[e.objectRefId],i=t.resolved.instances.find((t=>t.id===e.instanceId));if(i){let e={object:t,instance:i,pointer:{xPostion:n.x,yPosition:n.y}};this._hoveredOver=e,this.emit("timeline:hover",{detail:this._hoveredOver})}this._lastHoverAction=0,this._lastHoveredHash=r}}}))}t||0!==this._lastHoverAction||(this.emit("timeline:hover",{detail:void 0}),this._lastHoverAction=1)}}canvasScrollWheel(e){let t=this.getMousePos(this._canvasContainer,e);if(t.x<=this._viewDrawX)return;let n=!1;if(!0===e.ctrlKey){if(e.deltaY){n=!0;const r=Math.pow(1.001,-e.deltaY);this.zoomUnderCursor(t.x,r)}}else 0!==e.deltaX?(n=!0,this.canvasScrollByDeltaX(e.deltaX*(10*this.stepSize))):0!==e.deltaY&&!0===e.altKey&&(n=!0,this.canvasScrollByDeltaX(e.deltaY*(10*this.stepSize)));e.preventDefault(),e.stopPropagation(),n&&this.redrawTimeline()}canvasScrollByDeltaX(e){let t=this._viewStartTime+e/this.pixelsWidthPerUnitTime;t<0&&(t=0),t!==this._viewStartTime&&(this._viewStartTime=t)}zoomUnderCursor(e,t){let n=this.xCoordToTime(e),r=this.timeToRatio(n);this._timelineZoom=this._timelineZoom*t,r=Math.max(0,Math.min(1,r));let i=n-r*this.viewRange;i<0&&(i=0),this._viewStartTime=i}getMousePos(e,t){const n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}trimTimeline(e,t){let n={};return Object.keys(e.objects).forEach((r=>{const i=e.objects[r],s=[];if(i.resolved.instances.forEach((e=>{let n=!1,r=Object.assign({},e);t.start&&(e.end||1/0)>t.start&&(n=!0,r.start<t.start&&(r.start=t.start)),t.end&&e.start<t.end&&(n=!0,(r.end||1/0)>t.end&&(r.end=t.end)),t.start||t.end||(n=!0),n&&r.start<(r.end||1/0)&&s.push(r)})),!n[r]){let e={content:i.content,enable:i.enable,id:i.id,layer:i.layer,resolved:Object.assign(Object.assign({},i.resolved),{instances:[]})};n[r]=e}n[r].resolved.instances=s})),{classes:e.classes,layers:e.layers,objects:n,statistics:e.statistics,nextEvents:e.nextEvents}}mergeTimelineObjects(e,t,n){const i={};n?(e=this.trimTimeline(e,{end:this._playHeadTime}),t=this.trimTimeline(t,{start:this._playHeadTime}),this._mergeIterator++,Object.keys(e.objects).forEach((n=>{const s=e.objects[n];if(s.__pastObj)return void(i[n]=s);const o=t.objects[n];if(o){if(r(Object.assign({},s,{resolved:null}),Object.assign({},o,{resolved:null}))){const e={};return s.resolved.instances.forEach((t=>{e[t.end+""]=t})),o.resolved.instances.forEach((t=>{e[t.start+""]?e[t.start+""].end=t.end:e[t.start+""]=t})),o.resolved.instances=[],Object.keys(e).forEach((t=>{const n=e[t];o.resolved.instances.push(n)})),void(i[n]=o)}i[n]=o}s.__pastObj=!0,i[this._mergeIterator+"__"+n]=s})),Object.keys(t.objects).forEach((n=>{const r=t.objects[n];e.objects[n]||(i[n]=r)}))):(Object.keys(e.objects).forEach((t=>{const n=e.objects[t];i[t]=n})),Object.keys(t.objects).forEach((e=>{const n=t.objects[e],r=i[e];if(r){const e={};r.resolved.instances.forEach((t=>{e[t.start+"_"+t.end]=!0})),n.resolved.instances.forEach((t=>{e[t.start+"_"+t.end]||r.resolved.instances.push(t)}))}else i[e]=n})));const s={};return Object.keys(i).forEach((e=>{const t=i[e].layer+"";s[t]||(s[t]=[]),s[t].push(e)})),Object.assign(Object.assign({},t),{objects:i,layers:s})}updateTimelineResolveWindow(){const{start:e,end:t}=this.getExpandedStartEndTime(1);if(this._timelineResolveStart=e,this._timelineResolveEnd=t,this._timelineResolveZoom=this._timelineZoom,this.latestUpdateTime){let e=50/this.latestUpdateTime;this._timelineResolveCountAdjust=Math.max(.1,Math.min(10,(1+this._timelineResolveCountAdjust*e)/2))}}getExpandedStartEndTime(e=1){let t=this._viewStartTime,n=this.viewEndTime,r=(n-t)*(this._timelineResolveExpand-1)*e;t-=.33*r,n+=.66*r,t=Math.max(0,t),n=Math.max(0,n);return{start:t,end:n,zoomDiff:Math.max(this._timelineResolveZoom,this._timelineZoom)/Math.min(this._timelineResolveZoom,this._timelineZoom)}}checkAutomaticReresolve(){const{start:e,end:t,zoomDiff:n}=this.getExpandedStartEndTime(.2);this._timelineResolveAuto&&(e<this._timelineResolveStart||t>this._timelineResolveEnd||n>3)&&(this.reresolveTimeout||(this.reresolveTimeout=setTimeout((()=>{this.reresolveTimeout=null,this.updateTimelineResolveWindow(),this._updateTimeline()}),Math.max(100,5*this.latestUpdateTime))))}timeToXCoord(e){return this._viewDrawX+(e-this._viewStartTime)*this.pixelsWidthPerUnitTime}xCoordToTime(e){return this._viewStartTime+(e-this._viewDrawX)/this.pixelsWidthPerUnitTime}timeToRatio(e){return(e-this._viewStartTime)/this.viewRange}istimeInView(e){const t=this.timeToRatio(e);return t>=0&&t<1}capXcoordToView(e){return Math.max(this._viewDrawX,Math.min(this._viewDrawX+this._viewDrawWidth,e))}get pixelsWidthPerUnitTime(){return this._timelineZoom/100}get viewRange(){return this._viewDrawWidth/this.pixelsWidthPerUnitTime}get viewEndTime(){return this._viewStartTime+this.viewRange}}n.TimelineVisualizer=l},{events:4,"lodash.isequal":5,"superfly-timeline":13}],3:[function(e,t,n){},{}],4:[function(e,t,n){var r=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},s=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0;var a,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function f(e,t,n,i){var s,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]):(o=e._events=r(null),e._eventsCount=0),a){if("function"==typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(s=u(e))&&s>0&&a.length>s){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else a=o[t]=n,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=s.call(d,r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(!r)return[];var i=r[t];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):b(i,i.length):[]}function v(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function b(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}a?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');l=e}}):o.defaultMaxListeners=l,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){var t,n,r,i,s,o,a="error"===e;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(n=o[e]))return!1;var c="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,i=b(e,r),s=0;s<r;++s)i[s].call(n)}(n,c,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,s=b(e,i),o=0;o<i;++o)s[o].call(n,r)}(n,c,this,arguments[1]);break;case 3:!function(e,t,n,r,i){if(t)e.call(n,r,i);else for(var s=e.length,o=b(e,s),a=0;a<s;++a)o[a].call(n,r,i)}(n,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,i,s){if(t)e.call(n,r,i,s);else for(var o=e.length,a=b(e,o),l=0;l<o;++l)a[l].call(n,r,i,s)}(n,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),s=1;s<r;s++)i[s-1]=arguments[s];!function(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,s=b(e,i),o=0;o<i;++o)s[o].apply(n,r)}(n,c,this,i)}return!0},o.prototype.addListener=function(e,t){return f(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return f(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,s,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=r(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;0===s?n.shift():function(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}(n,s),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.removeAllListeners=function(e){var t,n,s;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=r(null):delete n[e]),this;if(0===arguments.length){var o,a=i(n);for(s=0;s<a.length;++s)"removeListener"!==(o=a[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},o.prototype.listenerCount=v,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],5:[function(e,t,n){(function(e){(function(){var r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",h="[object Function]",p="[object GeneratorFunction]",v="[object Map]",b="[object Number]",y="[object Null]",m="[object Object]",_="[object Promise]",g="[object Proxy]",w="[object RegExp]",j="[object Set]",O="[object String]",T="[object Symbol]",E="[object Undefined]",R="[object WeakMap]",I="[object ArrayBuffer]",x="[object DataView]",S=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,C={};C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C[a]=C[l]=C[I]=C[u]=C[x]=C[f]=C[d]=C[h]=C[v]=C[b]=C[m]=C[w]=C[j]=C[O]=C[R]=!1;var $="object"==typeof e&&e&&e.Object===Object&&e,A="object"==typeof self&&self&&self.Object===Object&&self,M=$||A||Function("return this")(),L="object"==typeof n&&n&&!n.nodeType&&n,H=L&&"object"==typeof t&&t&&!t.nodeType&&t,k=H&&H.exports===L,D=k&&$.process,W=function(){try{return D&&D.binding&&D.binding("util")}catch(e){}}(),X=W&&W.isTypedArray;function z(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function N(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function F(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var K,V,U,B=Array.prototype,G=Function.prototype,q=Object.prototype,Z=M["__core-js_shared__"],Y=G.toString,J=q.hasOwnProperty,Q=(K=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",ee=q.toString,te=RegExp("^"+Y.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=k?M.Buffer:void 0,re=M.Symbol,ie=M.Uint8Array,se=q.propertyIsEnumerable,oe=B.splice,ae=re?re.toStringTag:void 0,le=Object.getOwnPropertySymbols,ce=ne?ne.isBuffer:void 0,ue=(V=Object.keys,U=Object,function(e){return V(U(e))}),fe=We(M,"DataView"),de=We(M,"Map"),he=We(M,"Promise"),pe=We(M,"Set"),ve=We(M,"WeakMap"),be=We(Object,"create"),ye=Fe(fe),me=Fe(de),_e=Fe(he),ge=Fe(pe),we=Fe(ve),je=re?re.prototype:void 0,Oe=je?je.valueOf:void 0;function Te(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ie(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Re;++t<n;)this.add(e[t])}function xe(e){var t=this.__data__=new Ee(e);this.size=t.size}function Se(e,t){var n=Ue(e),r=!n&&Ve(e),i=!n&&!r&&Be(e),s=!n&&!r&&!i&&Je(e),o=n||r||i||s,a=o?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],l=a.length;for(var c in e)!t&&!J.call(e,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ne(c,l))||a.push(c);return a}function Pe(e,t){for(var n=e.length;n--;)if(Ke(e[n][0],t))return n;return-1}function Ce(e){return null==e?void 0===e?E:y:ae&&ae in Object(e)?function(e){var t=J.call(e,ae),n=e[ae];try{e[ae]=void 0;var r=!0}catch(e){}var i=ee.call(e);r&&(t?e[ae]=n:delete e[ae]);return i}(e):function(e){return ee.call(e)}(e)}function $e(e){return Ye(e)&&Ce(e)==a}function Ae(e,t,n,r,o){return e===t||(null==e||null==t||!Ye(e)&&!Ye(t)?e!=e&&t!=t:function(e,t,n,r,o,c){var h=Ue(e),p=Ue(t),y=h?l:ze(e),_=p?l:ze(t),g=(y=y==a?m:y)==m,E=(_=_==a?m:_)==m,R=y==_;if(R&&Be(e)){if(!Be(t))return!1;h=!0,g=!1}if(R&&!g)return c||(c=new xe),h||Je(e)?He(e,t,n,r,o,c):function(e,t,n,r,o,a,l){switch(n){case x:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!a(new ie(e),new ie(t)));case u:case f:case b:return Ke(+e,+t);case d:return e.name==t.name&&e.message==t.message;case w:case O:return e==t+"";case v:var c=N;case j:var h=r&i;if(c||(c=F),e.size!=t.size&&!h)return!1;var p=l.get(e);if(p)return p==t;r|=s,l.set(e,t);var y=He(c(e),c(t),r,o,a,l);return l.delete(e),y;case T:if(Oe)return Oe.call(e)==Oe.call(t)}return!1}(e,t,y,n,r,o,c);if(!(n&i)){var S=g&&J.call(e,"__wrapped__"),P=E&&J.call(t,"__wrapped__");if(S||P){var C=S?e.value():e,$=P?t.value():t;return c||(c=new xe),o(C,$,n,r,c)}}if(!R)return!1;return c||(c=new xe),function(e,t,n,r,s,o){var a=n&i,l=ke(e),c=l.length,u=ke(t),f=u.length;if(c!=f&&!a)return!1;var d=c;for(;d--;){var h=l[d];if(!(a?h in t:J.call(t,h)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var v=!0;o.set(e,t),o.set(t,e);var b=a;for(;++d<c;){var y=e[h=l[d]],m=t[h];if(r)var _=a?r(m,y,h,t,e,o):r(y,m,h,e,t,o);if(!(void 0===_?y===m||s(y,m,n,r,o):_)){v=!1;break}b||(b="constructor"==h)}if(v&&!b){var g=e.constructor,w=t.constructor;g==w||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof w&&w instanceof w||(v=!1)}return o.delete(e),o.delete(t),v}(e,t,n,r,o,c)}(e,t,n,r,Ae,o))}function Me(e){return!(!Ze(e)||function(e){return!!Q&&Q in e}(e))&&(Ge(e)?te:S).test(Fe(e))}function Le(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||q,t!==r)return ue(e);var t,n,r,i=[];for(var s in Object(e))J.call(e,s)&&"constructor"!=s&&i.push(s);return i}function He(e,t,n,r,o,a){var l=n&i,c=e.length,u=t.length;if(c!=u&&!(l&&u>c))return!1;var f=a.get(e);if(f&&a.get(t))return f==t;var d=-1,h=!0,p=n&s?new Ie:void 0;for(a.set(e,t),a.set(t,e);++d<c;){var v=e[d],b=t[d];if(r)var y=l?r(b,v,d,t,e,a):r(v,b,d,e,t,a);if(void 0!==y){if(y)continue;h=!1;break}if(p){if(!z(t,(function(e,t){if(i=t,!p.has(i)&&(v===e||o(v,e,n,r,a)))return p.push(t);var i}))){h=!1;break}}else if(v!==b&&!o(v,b,n,r,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function ke(e){return function(e,t,n){var r=t(e);return Ue(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Qe,Xe)}function De(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function We(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Me(n)?n:void 0}Te.prototype.clear=function(){this.__data__=be?be(null):{},this.size=0},Te.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Te.prototype.get=function(e){var t=this.__data__;if(be){var n=t[e];return n===r?void 0:n}return J.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return be?void 0!==t[e]:J.call(t,e)},Te.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=be&&void 0===t?r:t,this},Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(e){var t=this.__data__,n=Pe(t,e);return!(n<0)&&(n==t.length-1?t.pop():oe.call(t,n,1),--this.size,!0)},Ee.prototype.get=function(e){var t=this.__data__,n=Pe(t,e);return n<0?void 0:t[n][1]},Ee.prototype.has=function(e){return Pe(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var n=this.__data__,r=Pe(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Re.prototype.clear=function(){this.size=0,this.__data__={hash:new Te,map:new(de||Ee),string:new Te}},Re.prototype.delete=function(e){var t=De(this,e).delete(e);return this.size-=t?1:0,t},Re.prototype.get=function(e){return De(this,e).get(e)},Re.prototype.has=function(e){return De(this,e).has(e)},Re.prototype.set=function(e,t){var n=De(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Ie.prototype.add=Ie.prototype.push=function(e){return this.__data__.set(e,r),this},Ie.prototype.has=function(e){return this.__data__.has(e)},xe.prototype.clear=function(){this.__data__=new Ee,this.size=0},xe.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},xe.prototype.get=function(e){return this.__data__.get(e)},xe.prototype.has=function(e){return this.__data__.has(e)},xe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ee){var r=n.__data__;if(!de||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Re(r)}return n.set(e,t),this.size=n.size,this};var Xe=le?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}(le(e),(function(t){return se.call(e,t)})))}:function(){return[]},ze=Ce;function Ne(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||P.test(e))&&e>-1&&e%1==0&&e<t}function Fe(e){if(null!=e){try{return Y.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ke(e,t){return e===t||e!=e&&t!=t}(fe&&ze(new fe(new ArrayBuffer(1)))!=x||de&&ze(new de)!=v||he&&ze(he.resolve())!=_||pe&&ze(new pe)!=j||ve&&ze(new ve)!=R)&&(ze=function(e){var t=Ce(e),n=t==m?e.constructor:void 0,r=n?Fe(n):"";if(r)switch(r){case ye:return x;case me:return v;case _e:return _;case ge:return j;case we:return R}return t});var Ve=$e(function(){return arguments}())?$e:function(e){return Ye(e)&&J.call(e,"callee")&&!se.call(e,"callee")},Ue=Array.isArray;var Be=ce||function(){return!1};function Ge(e){if(!Ze(e))return!1;var t=Ce(e);return t==h||t==p||t==c||t==g}function qe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}function Ze(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ye(e){return null!=e&&"object"==typeof e}var Je=X?function(e){return function(t){return e(t)}}(X):function(e){return Ye(e)&&qe(e.length)&&!!C[Ce(e)]};function Qe(e){return null!=(t=e)&&qe(t.length)&&!Ge(t)?Se(e):Le(e);var t}t.exports=function(e,t){return Ae(e,t)}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e("tslib");r.__exportStar(e("./expression"),n),r.__exportStar(e("./resolvedTimeline"),n),r.__exportStar(e("./resolver"),n),r.__exportStar(e("./state"),n),r.__exportStar(e("./timeline"),n),r.__exportStar(e("./types"),n)},{"./expression":6,"./resolvedTimeline":8,"./resolver":9,"./state":10,"./timeline":11,"./types":12,tslib:32}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EventType=void 0,function(e){e[e.START=0]="START",e[e.END=1]="END",e[e.KEYFRAME=2]="KEYFRAME"}(n.EventType||(n.EventType={}))},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.onCloseCleanup=n.validateExpression=n.wrapInnerExpressions=n.simplifyExpression=n.interpretExpression=n.applyKeyframeContent=n.validateReferenceString=n.validateKeyframe=n.validateObject=n.validateTimeline=n.getResolvedState=n.resolveTimeline=void 0;e("tslib").__exportStar(e("./api"),n);const r=e("./resolver/StateHandler"),i=e("./resolver/ExpressionHandler"),s=e("./resolver/ResolverHandler"),o=e("./resolver/TimelineValidator");let a;function l(){return a||(a=new i.ExpressionHandler(!0)),a}n.resolveTimeline=function(e,t){return new s.ResolverHandler(t).resolveTimeline(e)},n.getResolvedState=function(e,t,n=0){return(new r.StateHandler).getState(e,t,n)},n.validateTimeline=function(e,t){(new o.TimelineValidator).validateTimeline(e,t)},n.validateObject=function(e,t){(new o.TimelineValidator).validateObject(e,t)},n.validateKeyframe=function(e,t){(new o.TimelineValidator).validateKeyframe(e,t)},n.validateReferenceString=function(e,t){o.TimelineValidator.validateReferenceString(e,t)},n.applyKeyframeContent=function(e,t){r.StateHandler.applyKeyframeContent(e,t)},n.interpretExpression=function(e){return l().interpretExpression(e)},n.simplifyExpression=function(e){return l().simplifyExpression(e)},n.wrapInnerExpressions=function(e){return l().wrapInnerExpressions(e)},n.validateExpression=function(e,t,n){return l().validateExpression(e,t,n)},n.onCloseCleanup=function(){a&&a.clearCache()}},{"./api":7,"./resolver/ExpressionHandler":15,"./resolver/ResolverHandler":20,"./resolver/StateHandler":21,"./resolver/TimelineValidator":22,tslib:32}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.hashTimelineObject=n.CacheHandler=void 0;const r=e("./lib/lib"),i=e("./lib/performance"),s=e("./lib/reference"),o=e("./lib/timeline");function a(e){return`${JSON.stringify(e.enable)},${+!!e.disabled},${e.priority}',${e.resolved.parentId},${+e.resolved.isKeyframe},${e.classes?e.classes.join("."):""},${e.layer},${+!!e.seamless}`}n.CacheHandler=class{constructor(e,t){this.resolvedTimeline=t,e.objHashes||(e.objHashes={}),e.objects||(e.objects={}),e.canBeUsed?this.canUseIncomingCache=!0:(e.objHashes={},e.objects={},this.canUseIncomingCache=!1),e.canBeUsed=!1,this.cache=e}debug(...e){this.resolvedTimeline.options.debug&&console.log(...e)}determineChangedObjects(){const e=(0,i.tic)("  cache.determineChangedObjects"),t={},n={},r=e=>{const t=this.getAllReferencesThisObjectAffects(e);for(const e of t)n[e]=!0};for(const e of this.resolvedTimeline.objectsMap.values()){const n=this.cache.objHashes[e.id],i=a(e);if(t[e.id]=!0,n?n!==i&&this.debug(`Cache: Object "${e.id}" has changed`):this.debug(`Cache: Object "${e.id}" is new`),n&&n===i){n||this.debug(`Cache: Object "${e.id}" is similar`);const t=this.cache.objects[e.id];if(!t)throw console.error("oldHash",n),console.error("ids",Object.keys(this.cache.objects)),new Error(`Internal Error: obj "${e.id}" not found in cache, even though hashes match!`);this.cache.objects[e.id]={...e,resolved:t.resolved}}else{this.cache.objHashes[e.id]=i,r(e);const t=this.cache.objects[e.id];t&&r(t)}}if(this.canUseIncomingCache){for(const e in this.cache.objects)if(!t[e]){const t=this.cache.objects[e];delete this.cache.objHashes[e],r(t)}const e={};for(const t of this.resolvedTimeline.objectsMap.values())e[t.id]=t;const i={};for(const e of this.resolvedTimeline.objectsMap.values()){const t=this.cache.objects[e.id];let r=this.getAllReferencesThisObjectAffects(e);t&&(r=(0,s.joinReferences)(r,this.getAllReferencesThisObjectAffects(t)));for(let t=0;t<r.length;t++){const n=r[t],s=`#${e.id}`;n!==s&&(i[s]||(i[s]=[]),i[s].push(n))}if(n[`#${e.id}`]);else if(t){const n=t.resolved.directReferences;for(let t=0;t<n.length;t++){const r=n[t];i[r]||(i[r]=[]),i[r].push(`#${e.id}`)}}}const o={};for(const t of Object.keys(n))this.invalidateObjectsWithReference(o,t,i,e);for(const t of Object.values(e)){if(!this.cache.objects[t.id])throw new Error(`Something went wrong: "${t.id}" does not exist in cache.resolvedTimeline.objects`);this.resolvedTimeline.objectsMap.set(t.id,this.cache.objects[t.id])}}e()}persistData(){const e=(0,i.tic)("  cache.persistData");this.resolvedTimeline.resolveError?(this.cache.objHashes={},this.cache.objects={},this.cache.canBeUsed=!1):(this.cache.objects=(0,r.mapToObject)(this.resolvedTimeline.objectsMap),this.cache.canBeUsed=!0),e()}getAllReferencesThisObjectAffects(e){const t=[`#${e.id}`];if(e.classes)for(const n of e.classes)t.push(`.${n}`);if((0,o.objHasLayer)(e)&&t.push(`$${e.layer}`),e.children)for(const n of e.children)t.push(`#${n.id}`);return t}invalidateObjectsWithReference(e,t,n,r){if(e[t])return;if(e[t]=!0,(0,s.isObjectReference)(t)){const e=(0,s.getRefObjectId)(t);r[e]&&delete r[e]}const i=n[t];if(i)for(let t=0;t<i.length;t++){const s=i[t];this.invalidateObjectsWithReference(e,s,n,r)}}},n.hashTimelineObject=a},{"./lib/lib":28,"./lib/performance":29,"./lib/reference":30,"./lib/timeline":31}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExpressionHandler=n.REGEXP_OPERATORS=n.OPERATORS=void 0;const r=e("./lib/lib"),i=e("./lib/cache"),s=e("./lib/expression");n.OPERATORS=["&","|","+","-","*","/","%","!"],n.REGEXP_OPERATORS=new RegExp("(["+n.OPERATORS.map((e=>"\\"+e)).join("")+"\\(\\)])","g");function o(e,t){return-1!==e.indexOf(t)}n.ExpressionHandler=class{constructor(e,t){this.skipValidation=t,this.cache=new i.Cache(e)}interpretExpression(e){if((0,s.isNumericExpr)(e))return parseFloat(e);if("string"==typeof e){const t=e;return this.cache.cacheResult(t,(()=>{const e=t.replace(n.REGEXP_OPERATORS," $1 "),i=(0,r.compact)(e.split(" "));if(0===i.length)return null;for(let e=i.length-2;e>=1;e--)"-"!==i[e]&&"+"!==i[e]||!o(n.OPERATORS,i[e-1])||(i[e]=i[e]+i[e+1],i.splice(e+1,1));const s=this.wrapInnerExpressions(i);if(s.rest.length)throw new Error(`interpretExpression: syntax error: parentheses don't add up in "${e}".`);if(s.inner.length%2!=1)throw new Error(`interpretExpression: operands & operators don't add up: "${s.inner.join(" ")}".`);const a=this.words2Expression(n.OPERATORS,s.inner);return this.skipValidation||this.validateExpression(n.OPERATORS,a),a}),36e5)}return e}simplifyExpression(e){const t="string"==typeof e?this.interpretExpression(e):e;if(!t)return t;if(function(e){return"object"==typeof e&&null!==e&&void 0!==e.l&&void 0!==e.o&&void 0!==e.r}(t)){const e=this.simplifyExpression(t.l),n=t.o,r=this.simplifyExpression(t.r);if("number"==typeof e&&"number"==typeof r)switch(n){case"+":return e+r;case"-":return e-r;case"*":return e*r;case"/":return e/r;case"%":return e%r;default:return{l:e,o:n,r:r}}return{l:e,o:n,r:r}}return t}wrapInnerExpressions(e){for(let t=0;t<e.length;t++)switch(e[t]){case"(":{const n=this.wrapInnerExpressions(e.slice(t+1));e[t]=n.inner,e.splice(t+1,99999,...n.rest);break}case")":return{inner:e.slice(0,t),rest:e.slice(t+1)};case"!":{const n=this.wrapInnerExpressions(e.slice(t+1));e[t]=["","!"].concat(n.inner),e.splice(t+1,99999,...n.rest);break}}return{inner:e,rest:[]}}validateExpression(e,t,n){if(n||(n="ROOT"),(0,r.isObject)(t)&&!(0,r.isArray)(t)){const r=t;if(void 0===r.l)throw new Error(`validateExpression: ${n}.l missing in ${JSON.stringify(r)}`);if(void 0===r.o)throw new Error(`validateExpression: ${n}.o missing in ${JSON.stringify(r)}`);if(void 0===r.r)throw new Error(`validateExpression: ${n}.r missing in ${JSON.stringify(r)}`);if("string"!=typeof r.o)throw new Error(`validateExpression: ${n}.o not a string`);if(!o(e,r.o))throw new Error(n+'.o not valid: "'+r.o+'"');return this.validateExpression(e,r.l,n+".l")&&this.validateExpression(e,r.r,n+".r")}if(null!==t&&"string"!=typeof t&&"number"!=typeof t)throw new Error(`validateExpression: ${n} is of invalid type`);return!0}clearCache(){this.cache.clear()}words2Expression(e,t){if(!t?.length)throw new Error("words2Expression: syntax error: unbalanced expression");for(;1===t.length&&null!==t[0]&&(0,r.isArray)(t[0]);)t=t[0];if(1===t.length)return t[0];let n=-1;for(let r=0;r<e.length;r++){const i=e[r];-1===n&&(n=t.lastIndexOf(i))}if(-1!==n){const r=t.slice(0,n),i=t.slice(n+1);return{l:this.words2Expression(e,r),o:t[n],r:this.words2Expression(e,i)}}throw new Error('words2Expression: syntax error: operator not found: "'+t.join(" ")+'"')}}},{"./lib/cache":23,"./lib/expression":26,"./lib/lib":28}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.InstanceHandler=void 0;const r=e("./lib/cap"),i=e("./lib/event"),s=e("./lib/instance"),o=e("./lib/lib"),a=e("./lib/reference");n.InstanceHandler=class{constructor(e){this.resolvedTimeline=e}invertInstances(e){if(e.length){const t=[];0!==(e=this.cleanInstances(e,!0,!0))[0].start&&t.push({id:this.resolvedTimeline.getInstanceId(),isFirst:!0,start:0,end:null,references:(0,a.joinReferences)(e[0].references,`@${e[0].id}`)});for(let n=0;n<e.length;n++){const r=e[n],i=(0,o.last)(t);i&&(i.end=r.start),null!==r.end&&t.push({id:this.resolvedTimeline.getInstanceId(),start:r.end,end:null,references:(0,a.joinReferences)(r.references,`@${r.id}`),caps:r.caps})}return t}return[{id:this.resolvedTimeline.getInstanceId(),isFirst:!0,start:0,end:null,references:[]}]}convertEventsToInstances(e,t,n=!1,r=!1){(0,i.sortEvents)(e);const s={};let o=null,a=!1;const l={};let c=!1,u=null;const f=[];for(let i=0;i<e.length;i++){const d=e[i],h=d.data.id??d.data.instance.id,p=f[f.length-1];if(d.value?(s[h]=d,delete l[h]):(delete s[h],l[h]=d),Object.keys(s).length){if(!t&&!n&&p&&c)p.start=d.time;else{const e=this.handleActiveInstances(d,p,o,h,s,t,n);if(o=e.activeInstanceId,e.returnInstance){let t=e.returnInstance;r&&(t={...t},t.originalStart=void 0,t.originalEnd=void 0),f.push(t)}}a=!0,c=!1}else{if(p&&a)p.end=d.time;else if(Object.keys(l).length&&!d.data.notANegativeInstance){const e=this.handleActiveInstances(d,p,u,h,l,t,n);if(u=e.activeInstanceId,e.returnInstance){const t={...e.returnInstance,start:e.returnInstance.end??0,end:e.returnInstance.start};r&&(t.originalStart=void 0,t.originalEnd=void 0),f.push(t)}c=!0}a=!1}}for(const e of f)null!==e.end&&e.end<e.start&&(e.end=e.start);return f}handleActiveInstances(e,t,n,i,l,c,u=!1){let f=null;if(!c&&e.value&&t&&null===t.end&&null!==n&&n!==i)t.end=e.time,f={id:this.resolvedTimeline.getInstanceId(),start:e.time,end:null,references:e.references,originalEnd:e.data.instance.originalEnd,originalStart:e.data.instance.originalStart},n=i;else if(c||e.value||!t||n!==i)c&&!u&&t&&t.end===e.time?(t.end=null,t.references=(0,a.joinReferences)(t.references,e.references),(0,r.addCapsToResuming)(t,e.data.instance.caps)):t&&null===t.end?(t.references=(0,a.joinReferences)(t.references,e.references),(0,r.addCapsToResuming)(t,e.data.instance.caps)):(f={id:(0,s.isInstanceId)(i)?i:`@${i}`,start:e.time,end:null,references:e.references,caps:e.data.instance.caps,originalEnd:e.data.instance.originalEnd,originalStart:e.data.instance.originalStart},n=i);else{const r=(0,o.reduceObj)(l,((e,t,n)=>null===e||e.event.time<t.time?{event:t,id:n}:e),null);r&&(t.end=e.time,f={id:(0,s.isInstanceId)(i)?`${i}_${this.resolvedTimeline.getInstanceId()}`:`@${i}_${this.resolvedTimeline.getInstanceId()}`,start:e.time,end:null,references:r.event.references,originalEnd:e.data.instance.originalEnd,originalStart:e.data.instance.originalStart},n=r.id)}return t?.caps&&!t.caps.length&&delete t.caps,f&&t&&t.start===t.end&&t.end===f.start&&(t.id=f.id,t.start=f.start,t.end=f.end,t.references=f.references,t.caps=f.caps,t.originalStart=f.originalStart,t.originalEnd=f.originalEnd,f=null),{activeInstanceId:n,returnInstance:f}}cleanInstances(e,t,n=!1){if(0===e.length)return[];if(1===e.length)return e;const r=[];for(const t of e)r.push({time:t.start,value:!0,data:{instance:t},references:t.references}),null!==t.end&&r.push({time:t.end,value:!1,data:{instance:t},references:t.references});return this.convertEventsToInstances(r,t,n)}capInstances(e,t,n=!0){if((0,a.isReference)(t)||null===t)return e;let r=[];for(let n=0;n<e.length;n++){const i=e[n],s=new Set;for(let e=0;e<t.length;e++){const n=t[e];if(i.start<=(n.end??1/0)&&(i.end??1/0)>=n.start){const e=this.capInstance(i,n);e.start>=n.start&&(e.end??1/0)<=(n.end??1/0)&&(e.start===e.end&&s.has(e.start)||(e.references=(0,a.joinReferences)(e.references,n.references),r.push(e),s.add(e.start),e.end&&s.add(e.end)))}}}r.sort(((e,t)=>e.start-t.start));const i={};for(const e of r)void 0!==i[e.id]?e.id=`${e.id}${++i[e.id]}`:i[e.id]=0;return r=this.cleanInstances(r,!0,n),r}capInstance(e,t){const n={...e};return n.start<t.start&&this.setInstanceStartTime(n,t.start),(n.end??1/0)>(t.end??1/0)&&this.setInstanceEndTime(n,t.end),n}setInstanceEndTime(e,t){e.originalEnd=e.originalEnd??e.end,e.end=t}setInstanceStartTime(e,t){e.originalStart=e.originalStart??e.start,e.start=t}applyRepeatingInstances(e,t){if(null===t||!t.value)return e;const n=this.resolvedTimeline.options,r=t.value,i=[];for(const s of e){let e=Math.max(n.time-(n.time-s.start)%r,s.start),o=null===s.end?null:s.end+(e-s.start);const l=(s.caps?s.caps.find((e=>-1!==s.references.indexOf(`@${e.id}`))):null)??null,c=n.limitCount??2;for(let u=0;u<c&&!(n.limitTime&&e>=n.limitTime);u++){const n=l?Math.max(l.start,e):e,c=l&&null!==l.end&&null!==o?Math.min(l.end,o):o;(c??1/0)>n&&i.push({id:this.resolvedTimeline.getInstanceId(),start:n,end:c,references:(0,a.joinReferences)(s.references,t.references,`@${s.id}`)}),e+=r,null!==o&&(o+=r)}}return this.cleanInstances(i,!1)}}},{"./lib/cap":24,"./lib/event":25,"./lib/instance":27,"./lib/lib":28,"./lib/reference":30}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LayerStateHandler=void 0;const r=e("./lib/lib"),i=e("./lib/performance");function s(e,t){return e.resolved.levelDeep-t.resolved.levelDeep||(0,r.compareStrings)(e.id,t.id)}function o(e,t){if(e.instance.id===t.instance.id&&e.instance.start===t.instance.start&&e.instance.end===t.instance.end){if("start"===e.instanceEvent&&"end"===t.instanceEvent)return-1;if("end"===e.instanceEvent&&"start"===t.instanceEvent)return 1}if("start"===e.instanceEvent&&"end"===t.instanceEvent)return 1;if("end"===e.instanceEvent&&"start"===t.instanceEvent)return-1;if(e.instance.start===e.instance.end||t.instance.start===t.instance.end){const n=(e.instance.end??1/0)-(t.instance.end??1/0);if(n)return n}if(e.obj.resolved&&t.obj.resolved){const n=e.obj.resolved.levelDeep-t.obj.resolved.levelDeep;if(n)return n}return(0,r.compareStrings)(e.obj.id,t.obj.id)||(0,r.compareStrings)(e.instance.id,t.instance.id)}n.LayerStateHandler=class{constructor(e,t,n){this.resolvedTimeline=e,this.instance=t,this.layer=n,this.pointsInTime={},this.objectsOnLayer=[],this.objectIdsOnLayer=this.resolvedTimeline.getLayerObjects(n)}debug(...e){this.resolvedTimeline.options.debug&&console.log(...e)}resolveConflicts(){const e=(0,i.tic)("       resolveConflicts");for(const e of this.objectIdsOnLayer)this.objectsOnLayer.push(this.resolvedTimeline.getObject(e));if(1===this.objectsOnLayer.length){for(const e of this.objectsOnLayer){e.resolved.resolvedConflicts=!0;for(const t of e.resolved.instances)t.originalStart=t.originalStart??t.start,t.originalEnd=t.originalEnd??t.end}return}this.debug(`======= resolveConflicts "${this.layer}" (${this.objectsOnLayer.length} objects)`),this.objectsOnLayer.sort(s);for(const e of this.objectsOnLayer){for(const t of e.resolved.instances){const n=[];n.push({time:t.start,enable:!0}),t.end&&n.push({time:t.end,enable:!1});for(const r of n)r.enable?this.addPointInTime(r.time,"start",e,t):this.addPointInTime(r.time,"end",e,t)}e.resolved.resolvedConflicts=!0,e.resolved.instances.splice(0)}let t;const n={};let r=[];const c=Object.keys(this.pointsInTime).map((e=>parseFloat(e))).sort(((e,t)=>e-t));for(const e of c){this.debug(`-------------- time: ${e}`);const i=new Set,s=this.pointsInTime[e];s.sort(o);for(let o=0;o<s.length;o++){const c=s[o],u=c.obj,f=c.instance;let d;d=f.start===e&&f.end===e?"start"===c.instanceEvent:(f.start||0)<=e&&(f.end??1/0)>e;const h=`${u.id}_${f.id}_${c.instanceEvent}`;if(!i.has(h)){i.add(h),d?r.push({obj:u,instance:f}):r=a(r,u.id),r.sort(l);const s=r[0],o=t,c=s&&(!o||o.id!==s.obj.id||!o.instance.id.startsWith(`${s.instance.id}`)),p=!s&&o;if((c||p)&&o&&(this.instance.setInstanceEndTime(o.instance,e),this.debug(`${o.id} stop`),delete n[o.id]),c){const r=s.obj;this.debug(`${r.id} play`);const i={...s.instance,start:e,end:null,fromInstanceId:s.instance.id,originalEnd:s.instance.originalEnd??s.instance.end,originalStart:s.instance.originalStart??s.instance.start};for(let e=0;e<r.resolved.instances.length;e++)r.resolved.instances[e].id===i.id&&(i.id=`${i.id}_$${r.resolved.instances.length}`);r.resolved.instances.push(i);const o={...r,instance:i};t=o,n[o.id]=o}else p&&(t=void 0)}}}{const e=this.objectsOnLayer.filter((e=>!!e.resolved.parentId)).sort(((e,t)=>e.resolved.levelDeep-t.resolved.levelDeep));for(const t of e)if(t.resolved.parentId){const e=this.resolvedTimeline.getObject(t.resolved.parentId);e&&(t.resolved.instances=this.instance.cleanInstances(this.instance.capInstances(t.resolved.instances,e.resolved.instances),!1,!1))}}this.debug("==== resolveConflicts done"),e()}addPointInTime(e,t,n,r){this.debug("addPointInTime",e,t,r),this.pointsInTime[e+""]||(this.pointsInTime[e+""]=[]),this.pointsInTime[e+""].push({obj:n,instance:r,instanceEvent:t})}};const a=(e,t)=>{const n=[];for(let r=0;r<e.length;r++)e[r].obj.id!==t&&n.push(e[r]);return n};function l(e,t){return(t.obj.priority||0)-(e.obj.priority||0)||t.instance.start-e.instance.start||(0,r.compareStrings)(e.obj.id,t.obj.id)||(0,r.compareStrings)(e.instance.id,t.instance.id)}},{"./lib/lib":28,"./lib/performance":29}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ReferenceHandler=void 0;const r=e("./lib/lib"),i=e("./lib/cap"),s=e("./lib/event"),o=e("./lib/reference"),a=e("./lib/expression");n.ReferenceHandler=class{constructor(e,t){this.resolvedTimeline=e,this.instance=t,this.operateApplyParentInstance=(e,t)=>null===e||null===t?null:{value:e.value+t.value,references:(0,o.joinReferences)(e.references,t.references)}}lookupExpression(e,t,n){if(null===t)return{result:null,allReferences:[]};if("string"==typeof t&&(0,a.isNumericExpr)(t))return{result:{value:parseFloat(t),references:[]},allReferences:[]};if("number"==typeof t)return{result:{value:t,references:[]},allReferences:[]};if("string"==typeof t){const i=(t=t.trim()).toLowerCase();if("true"===i)return{result:{value:0,references:[]},allReferences:[]};if("false"===i)return{result:null,allReferences:[]};let s=[],o=n,a="",l=[];const c=[];let u=!1;const f=/^\W*#([^.]+)(.*)/.exec(t);if(f){const e=f[1];a=f[2],u=!0,l=[e],c.push(`#${e}`)}else{const e=/^\W*\.([^.]+)(.*)/.exec(t);if(e){const t=e[1];a=e[2],u=!0,l=this.resolvedTimeline.getClassObjects(t)??[],c.push(`.${t}`)}else{const e=/^\W*\$([^.]+)(.*)/.exec(t);if(e){const t=e[1];a=e[2],u=!0,l=this.resolvedTimeline.getLayerObjects(t)??[],c.push(`$${t}`)}}}for(let t=0;t<l.length;t++){const n=l[t];if(n===e.id)e.resolved.resolving&&(e.resolved.isSelfReferencing=!0);else{const e=this.resolvedTimeline.getObject(n);e&&s.push(e)}}if(!u)return{result:null,allReferences:[]};if(e.resolved.isSelfReferencing&&(s=s.filter((e=>!e.resolved.isSelfReferencing))),s.length){if(/start/.exec(a)?o="start":/end/.exec(a)?o="end":/duration/.exec(a)&&(o="duration"),"duration"===o)return this.lookupReferencedObjsDuration(e,s,c);if("start"===o)return this.lookupReferencedObjs(e,s,c,!1,!1);if("end"===o)return this.lookupReferencedObjs(e,s,c,!0,!0);(0,r.assertNever)(o)}return{result:[],allReferences:c}}return t?this.lookupExpressionObj(e,n,t):{result:null,allReferences:[]}}applyParentInstances(e,t){return this.operateOnArrays(e,t,this.operateApplyParentInstance)}operateOnArrays(e,t,n){if(null===e||null===t)return null;if((0,o.isReference)(e)&&(0,o.isReference)(t))return n(e,t);const s=[],a=Math.min((0,r.isArray)(e)?e.length:1/0,(0,r.isArray)(t)?t.length:1/0);for(let l=0;l<a;l++){const a=(0,r.isArray)(e)?e[l]:{id:"@",start:e.value,end:e.value,references:e.references},c=(0,r.isArray)(t)?t[l]:{id:"@",start:t.value,end:t.value,references:t.references},u=a.isFirst?{value:a.start,references:a.references}:c.isFirst?{value:c.start,references:c.references}:n({value:a.start,references:(0,o.joinReferences)(a.references,"@"===a.id?[]:`@${a.id}`)},{value:c.start,references:(0,o.joinReferences)(c.references,"@"===c.id?[]:`@${c.id}`)}),f=a.isFirst?null!==a.end?{value:a.end,references:a.references}:null:c.isFirst?null!==c.end?{value:c.end,references:c.references}:null:n(null!==a.end?{value:a.end,references:(0,o.joinReferences)(a.references,"@"===a.id?[]:`@${a.id}`)}:null,null!==c.end?{value:c.end,references:(0,o.joinReferences)(c.references,"@"===c.id?[]:`@${c.id}`)}:null);null!==u&&s.push({id:this.resolvedTimeline.getInstanceId(),start:u.value,end:null===f?null:f.value,references:(0,o.joinReferences)(u.references,null!==f?f.references:[]),caps:(0,i.joinCaps)(a.caps,c.caps)})}return this.instance.cleanInstances(s,!1)}lookupReferencedObjsDuration(e,t,n){const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(this.resolvedTimeline.resolveTimelineObj(i),i.resolved.resolvedReferences)if(e.resolved.isSelfReferencing&&i.resolved.isSelfReferencing);else{const e=i.resolved.instances[0];if(e){const t=null!==e.end?e.end-e.start:null;null!==t&&r.push({value:t,references:(0,o.joinReferences)([`#${i.id}`],e.references)})}}}let i=null;for(let e=0;e<r.length;e++){const t=r[e];(null===i||t.value<i.value)&&(i=t)}return{result:i,allReferences:n}}lookupReferencedObjs(e,t,n,r,i){let s=[];for(let n=0;n<t.length;n++){const r=t[n];this.resolvedTimeline.resolveTimelineObj(r),r.resolved.resolvedReferences&&(e.resolved.isSelfReferencing&&r.resolved.isSelfReferencing||(s=s.concat(r.resolved.instances)))}if(s.length){if(s=r?this.instance.invertInstances(s):this.instance.cleanInstances(s,!0,!0),i){const e=s[0];e&&0===e.start&&s.splice(0,1)}return{result:s,allReferences:n}}return{result:[],allReferences:n}}lookupExpressionObj(e,t,n){const i=this.lookupExpression(e,n.l,t),s=this.lookupExpression(e,n.r,t),o={l:i.result,o:n.o,r:s.result},a=i.allReferences.concat(s.allReferences);if("!"===o.o)return o.r&&(0,r.isArray)(o.r)?{result:this.instance.invertInstances(o.r),allReferences:a}:{result:o.r,allReferences:a};if(null===o.l||null===o.r)return{result:null,allReferences:a};if("&"===o.o||"|"===o.o){return{result:new l(this.resolvedTimeline,o.l,o.r,o.o).calculateResult(),allReferences:a}}{const e=c.get(o.o);return{result:this.operateOnArrays(o.l,o.r,e),allReferences:a}}}};class l{constructor(e,t,n,i){this.resolvedTimeline=e,this.leftOperand=t,this.rightOperand=n,this.events=[],this.instances=[],"&"===i?this.calcResult=(e,t)=>!(!e||!t):"|"===i?this.calcResult=(e,t)=>!(!e&&!t):((0,r.assertNever)(i),this.calcResult=()=>!1),(0,r.isArray)(t)&&this._addInstanceEvents(t,!0),(0,r.isArray)(n)&&this._addInstanceEvents(n,!1),this.events=(0,s.sortEvents)(this.events)}_addInstanceEvents(e,t){for(let n=0;n<e.length;n++){const r=e[n];r.start!==r.end&&(this.events.push({left:t,time:r.start,value:!0,references:[],data:!0,instance:r}),null!==r.end&&this.events.push({left:t,time:r.end,value:!1,references:[],data:!1,instance:r}))}}calculateResult(){let e=!!(0,o.isReference)(this.leftOperand)&&!!this.leftOperand.value,t=!!(0,o.isReference)(this.rightOperand)&&!!this.rightOperand.value,n=null,r=null,i=this.calcResult(e,t);this.updateInstance(0,i,(0,o.joinReferences)((0,o.isReference)(this.leftOperand)?this.leftOperand.references:[],(0,o.isReference)(this.rightOperand)?this.rightOperand.references:[]),[]);for(let s=0;s<this.events.length;s++){const a=this.events[s],l=this.events[s+1];if(a.left?(e=a.value,n=a.instance):(t=a.value,r=a.instance),!l||l.time!==a.time){const s=this.calcResult(e,t),l=(n?n.caps??[]:[]).concat(r?r.caps??[]:[]);s!==i&&(this.updateInstance(a.time,s,(0,o.joinReferences)(n?n.references:[],r?r.references:[]),l),i=s)}}return this.instances}updateInstance(e,t,n,i){if(t)this.instances.push({id:this.resolvedTimeline.getInstanceId(),start:e,end:null,references:n,caps:i});else{const t=(0,r.last)(this.instances);t&&(t.end=e)}}}class c{static get(e){switch(e){case"+":return c.Add;case"-":return c.Subtract;case"*":return c.Multiply;case"/":return c.Divide;case"%":return c.Modulo;default:return(0,r.assertNever)(e),c.Null}}}c.Add=(e,t)=>null===e||null===t?null:{value:e.value+t.value,references:(0,o.joinReferences)(e.references,t.references)},c.Subtract=(e,t)=>null===e||null===t?null:{value:e.value-t.value,references:(0,o.joinReferences)(e.references,t.references)},c.Multiply=(e,t)=>null===e||null===t?null:{value:e.value*t.value,references:(0,o.joinReferences)(e.references,t.references)},c.Divide=(e,t)=>null===e||null===t?null:{value:e.value/t.value,references:(0,o.joinReferences)(e.references,t.references)},c.Modulo=(e,t)=>null===e||null===t?null:{value:e.value%t.value,references:(0,o.joinReferences)(e.references,t.references)},c.Null=()=>null},{"./lib/cap":24,"./lib/event":25,"./lib/expression":26,"./lib/lib":28,"./lib/reference":30}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResolvedTimelineHandler=void 0;const r=e("./ExpressionHandler"),i=e("./ReferenceHandler"),s=e("./lib/lib"),o=e("./InstanceHandler"),a=e("./lib/reference"),l=e("./lib/event"),c=e("./lib/instance"),u=e("./lib/timeline"),f=e("./LayerStateHandler"),d=e("./lib/expression"),h=e("./lib/performance"),p=e("./CacheHandler");function v(e,t){const n=e.value,r=t.value;if(n&&!r)return-1;if(!n&&r)return 1;const i=e.data.isParent,s=t.data.isParent;if(n){if(i&&!s)return-1;if(!i&&s)return 1}else{if(i&&!s)return 1;if(!i&&s)return-1}return 0}n.ResolvedTimelineHandler=class{constructor(e){this.options=e,this.objectsMap=new Map,this.classesMap=new Map,this.layersMap=new Map,this.directReferenceMap=new Map,this.statisticResolvingObjectCount=0,this.statisticResolvingCount=0,this.resolvedObjInstancesHash=new Map,this.changedObjIdsExplanations=[],this.objectsToReResolve=new Map,this.objectResolveCount=0,this._resolveError=void 0,this._idCount=0,this.expression=new r.ExpressionHandler(!1,this.options.skipValidation),this.instance=new o.InstanceHandler(this),this.reference=new i.ReferenceHandler(this,this.instance),this.debug=this.options.debug??!1}get resolveError(){return this._resolveError}addTimelineObject(e){this._addTimelineObject(e,0,void 0,!1)}resolveAllTimelineObjs(){const e=(0,h.tic)("  resolveAllTimelineObjs");this.debugTrace("=================================== resolveAllTimelineObjs");const t=this.objectsMap.size*(this.options.conflictMaxDepth??5);for(const e of this.objectsMap.values())this.resolveTimelineObj(e),this.resolvedObjInstancesHash.set(e.id,(0,c.getInstancesHash)(e.resolved.instances));if(!this._resolveError&&(this.resolveConflictsForObjs(null),!this._resolveError)){for(;this.objectsToReResolve.size>0;){if(this.objectResolveCount>=t){const e=new Error(`Maximum conflict iteration reached (${this.objectResolveCount}). This is due to a circular dependency in the timeline. Latest changes:\n${this.changedObjIdsExplanations.join("Next iteration -------------------------\n")}`);if(this.options.dontThrowOnError)return void(this._resolveError=e);throw e}this.debug&&(this.debugTrace("---------------------------------"),this.debugTrace(`objectsToReResolve: [${Array.from(this.objectsToReResolve.entries())}]`),this.debugTrace(`directReferences: [${Array.from(this.directReferenceMap.entries()).map((([e,t])=>`${e}: [${t}]`))}]`));const e=[];for(const t of this.objectsToReResolve.values()){this.objectResolveCount++;let n=!1;t.resolved.resolvedReferences||(this.resolveTimelineObj(t),n=!0),t.resolved.resolvedConflicts||(n=!0),n&&e.push(t)}if(this._resolveError)return;this.resolveConflictsForObjs(e)}e()}}resolveTimelineObj(e){if(e.resolved.resolving){const t=Error(`Circular dependency when trying to resolve "${e.id}"`);if(this.options.dontThrowOnError)return this._resolveError=t,e.resolved.firstResolved=!0,e.resolved.resolvedReferences=!0,e.resolved.resolving=!1,void(e.resolved.instances=[]);throw t}if(e.resolved.resolvedReferences)return;const t=(0,h.tic)("     resolveTimelineObj");e.resolved.resolving=!0,this.statisticResolvingCount++,e.resolved.firstResolved||this.statisticResolvingObjectCount++,this.debugTrace(`============ resolving "${e.id}"`);const n=[];let r=[];if(e.disabled)r=[];else{let t,i=null,o=!1;if(e.resolved.parentId){o=!0,t=`#${e.resolved.parentId}`;if(i=this.reference.lookupExpression(e,this.expression.interpretExpression(t),"start").result,null!==i)for(const e of i)e.references=(0,a.joinReferences)(e.references,t)}const l=(0,s.ensureArray)(e.enable);for(let o=0;o<l.length;o++){const c=l[o],u=void 0!==c.repeating?this.lookupExpression(e,n,c.repeating,"duration"):{result:null};let f,d;if(null===u.result)f=null;else if((0,s.isArray)(u.result))if(0===u.result.length)f=null;else{if(1!==u.result.length)throw new Error("lookupExpression should never return an array for .duration lookup");f=(0,s.literal)({value:u.result[0].start,references:u.result[0].references})}else f=u.result;if(void 0!==c.while){const t="1"===c.while||1===c.while?"true":"0"===c.while||0===c.while?"false":c.while,r=this.lookupExpression(e,n,t,"start");d=null===r.result?[]:(0,s.isArray)(r.result)?r.result:null!==r.result?[{id:this.getInstanceId(),start:r.result.value,end:null,references:r.result.references}]:[]}else if(void 0!==c.start){const r=this.lookupExpression(e,n,c.start,"start"),o=r.refersToParent?this.reference.applyParentInstances(i,r.result):r.result,l=[];let u=0,h=0;if(null===o);else if((0,s.isArray)(o))for(let t=0;t<o.length;t++){const n=o[t],r=`${e.id}_${u++}`;l.push({time:n.start,value:!0,data:{instance:n,id:r},references:n.references})}else l.push({time:o.value,value:!0,data:{instance:{id:this.getInstanceId(),start:o.value,end:null,references:o.references},id:`${e.id}_${u++}`},references:o.references});if(void 0!==c.end){const t=this.lookupExpression(e,n,c.end,"end"),r=t?t.refersToParent?this.reference.applyParentInstances(i,t.result):t.result:null;if(null===r);else if((0,s.isArray)(r))for(let t=0;t<r.length;t++){const n=r[t];l.push({time:n.start,value:!1,data:{instance:n,id:`${e.id}_${h++}`},references:n.references})}else r&&l.push({time:r.value,value:!1,data:{instance:{id:this.getInstanceId(),start:r.value,end:null,references:r.references},id:`${e.id}_${h++}`},references:r.references})}else if(void 0!==c.duration){let t=this.lookupExpression(e,n,c.duration,"duration").result;if(null===t);else if((0,s.isArray)(t))if(1===t.length)t=(0,s.literal)({value:t[0].start,references:t[0].references});else{if(0!==t.length)throw new Error("lookedupDuration should never return an array for .duration lookup");t=null}if(null!==t){null!==f&&t.value>f.value&&(t.value=f.value);for(let e=0;e<l.length;e++){const n=l[e];if(n.value){const e=n.time+t.value,r=(0,a.joinReferences)(n.references,t.references);l.push({time:e,value:!1,data:{id:n.data.id,instance:{id:n.data.instance.id,start:e,end:null,references:r}},references:r})}}}}if(d=this.instance.convertEventsToInstances(l,!1,!1,!0),t&&null!==i){const e=new Map;for(const t of i)e.set(t.id,t);const t=[];for(const n of d){let r;for(let t=n.references.length-1;t>=0;t--){const i=n.references[t];if((0,a.isInstanceReference)(i)&&(r=e.get((0,a.getRefInstanceId)(i)),r))break}if(r){const e=this.instance.capInstance(n,r);e.caps||(e.caps=[]),e.caps.push((0,s.literal)({id:r.id,start:r.start,end:r.end})),t.push(e)}else t.push(n)}d=t}}else d=[];d=this.instance.applyRepeatingInstances(d,f),(0,s.pushToArray)(r,d)}o&&(r=this.capInstancesToParentInstances({instances:r,parentInstances:i}))}const i=new Set;for(const e of r)i.has(e.id)&&(e.id=`${e.id}_${this.getInstanceId()}`),i.add(e.id);e.seamless&&r.length>1&&(r=this.instance.cleanInstances(r,!0,!1)),e.resolved.parentId&&n.push(`#${e.resolved.parentId}`),e.resolved.firstResolved||this.updateDirectReferenceMap(e,n),e.resolved.firstResolved=!0,e.resolved.resolvedReferences=!0,e.resolved.resolving=!1,e.resolved.instances=r,this.debug&&(this.debugTrace(`directReferences "${e.id}": ${JSON.stringify(n)}`),this.debugTrace(`resolved "${e.id}": ${JSON.stringify(e.resolved.instances)}`)),e.resolved.resolving=!1,t()}getStatistics(){const e=(0,h.tic)("  getStatistics");if(this.options.skipStatistics)return{totalCount:0,resolvedInstanceCount:0,resolvedObjectCount:0,resolvedGroupCount:0,resolvedKeyframeCount:0,resolvingObjectCount:0,resolvingCount:0};const t={totalCount:0,resolvedInstanceCount:0,resolvedObjectCount:0,resolvedGroupCount:0,resolvedKeyframeCount:0,resolvingObjectCount:this.statisticResolvingObjectCount,resolvingCount:this.statisticResolvingCount};for(const e of this.objectsMap.values())t.totalCount+=1,e.isGroup&&(t.resolvedGroupCount+=1),e.resolved.isKeyframe?t.resolvedKeyframeCount+=1:t.resolvedObjectCount+=1,t.resolvedInstanceCount+=e.resolved.instances.length;return e(),t}initializeCache(e){return this.cache=new p.CacheHandler(e,this),this.cache}getObject(e){return this.objectsMap.get(e)}getLayerObjects(e){return this.layersMap.get(e)}getClassObjects(e){return this.classesMap.get(e)}capInstancesToParentInstances(e){if(!e.parentInstances)return[];const t=[];for(const n of e.instances)t.push({time:n.start,value:!0,references:n.references,data:{instance:n,isParent:!1}}),null!==n.end&&t.push({time:n.end,value:!1,references:n.references,data:{instance:n,isParent:!1}});for(const n of e.parentInstances)t.push({time:n.start,value:!0,references:n.references,data:{instance:n,isParent:!0}}),null!==n.end&&t.push({time:n.end,value:!1,references:n.references,data:{instance:n,isParent:!0}});(0,l.sortEvents)(t,v);const n=[],r=[];let i;const s=[];function o(){i&&(s.push(i.instance),i=void 0)}for(const e of t){e.data.isParent?e.value?n.push(e.data.instance):(0,c.spliceInstances)(n,(t=>t===e.data.instance?void 0:t)):e.value?r.push(e.data.instance):(0,c.spliceInstances)(r,(t=>t===e.data.instance?void 0:t));const t=r[r.length-1],s=n[n.length-1];Boolean(t&&s)?(i&&(t.id!==i.instance.id||s!==i.parent&&!n.includes(i.parent)?(i.instance.end=e.time,i.instance.originalEnd=i.instance.originalEnd??e.time,i.instance.references=(0,a.joinReferences)(i.instance.references,e.data.instance.references),o()):i.instance.id!==t.id&&(i.instance.references=(0,a.joinReferences)(i.instance.references,t.references))),i||(i={instance:{...t,start:e.time,end:null,originalStart:t.originalStart??t.start,originalEnd:t.originalEnd??t.end??null,references:(0,a.joinReferences)(t.references,...n.map((e=>e.references)))},parent:s})):i&&(i.instance.end=e.time,i.instance.originalEnd=i.instance.originalEnd??e.time,i.instance.references=(0,a.joinReferences)(i.instance.references,e.data.instance.references),o())}return o(),s}updateDirectReferenceMap(e,t){e.resolved.directReferences=t;for(const n of t){const t=[];if((0,a.isObjectReference)(n)){const e=(0,a.getRefObjectId)(n);t.push(e)}else if((0,a.isClassReference)(n)){const e=(0,a.getRefClass)(n);for(const n of this.getClassObjects(e)??[])t.push(n)}else if((0,a.isLayerReference)(n)){const e=(0,a.getRefLayer)(n);for(const n of this.getLayerObjects(e)??[])t.push(n)}else(0,a.isInstanceReference)(n)||(0,s.assertNever)(n);for(const n of t){let t=this.directReferenceMap.get(n);t||(t=[],this.directReferenceMap.set(n,t)),t.push(e.id)}}}getObjectsLayers(e){const t=new Set;for(const n of e)(0,u.objHasLayer)(n)&&t.add(`${n.layer}`);return Array.from(t.values())}getAllObjectLayers(){return this.allObjectLayersCache||(this.allObjectLayersCache=this.getObjectsLayers(this.objectsMap.values())),this.allObjectLayersCache}lookupExpression(e,t,n,r){const i=this.expression.simplifyExpression(n),o=this.reference.lookupExpression(e,i,r);(0,s.pushToArray)(t,o.allReferences);const a=e.resolved.parentId&&(0,d.isConstantExpr)(i);return{allReferences:o.allReferences,result:o.result,refersToParent:a}}_addTimelineObject(e,t,n,r){const i=(0,h.tic)("  addTimelineObject");if(!this.options.skipValidation&&this.objectsMap.has(e.id))throw Error(`All timelineObjects must be unique! (duplicate: "${e.id}")`);{const i={...e,resolved:{firstResolved:!1,resolvedReferences:!1,resolvedConflicts:!1,resolving:!1,instances:[],levelDeep:t,isSelfReferencing:!1,directReferences:[],parentId:n,isKeyframe:r}};if(this.objectsMap.set(e.id,i),e.classes)for(let t=0;t<e.classes.length;t++){const n=e.classes[t];if(n){let t=this.classesMap.get(n);t||(t=[],this.classesMap.set(n,t)),t.push(e.id)}}if((0,u.objHasLayer)(e)){const t=`${e.layer}`;let n=this.layersMap.get(t);n||(n=[],this.layersMap.set(t,n)),n.push(e.id)}}if(e.isGroup&&e.children)for(let n=0;n<e.children.length;n++){const r=e.children[n];this._addTimelineObject(r,t+1,e.id,!1)}if(e.keyframes)for(let n=0;n<e.keyframes.length;n++){const r={...e.keyframes[n],layer:""};this._addTimelineObject(r,t+1,e.id,!0)}i()}resolveConflictsForObjs(e){const t=(0,h.tic)("     resolveConflictsForObjs");let n;this.changedObjIdsExplanations=[],this.objectsToReResolve.clear(),n=null===e?this.getAllObjectLayers():this.getObjectsLayers(e);for(const e of n){const t=this.resolveConflictsForLayer(e);this.updateObjectsToReResolve(t)}t()}resolveConflictsForLayer(e){const t=new f.LayerStateHandler(this,this.instance,e);for(const n of t.objectIdsOnLayer)if(this.objectsToReResolve.has(n))return this.debugTrace(`optimization: Skipping "${e}" since "${n}" changed`),[];return t.resolveConflicts(),t.objectsOnLayer}getInstanceId(){return`@${(this._idCount++).toString(36)}`}updateObjectsToReResolve(e){const t=(0,h.tic)("     updateObjectsToReResolve"),n=new Set;for(const t of e){const e=(0,c.getInstancesHash)(t.resolved.instances),r=this.resolvedObjInstancesHash.get(t.id)??"not-found";e!==r&&(this.changedObjIdsExplanations.push(`"${t.id}" changed from: \n   ${r}\n   , to \n   ${e}\n`),this.changedObjIdsExplanations.length>2&&this.changedObjIdsExplanations.shift(),this.debugTrace(`changed: ${t.id}: "${r}" -> "${e}"`),n.add(t.id),this.resolvedObjInstancesHash.set(t.id,e))}for(const e of n.values()){const t=this.directReferenceMap.get(e)??[];for(const e of t){const t=this.getObject(e);t.resolved.resolvedReferences=!1,this.objectsToReResolve.set(t.id,t)}}t()}debugTrace(...e){this.debug&&console.log(...e)}}},{"./CacheHandler":14,"./ExpressionHandler":15,"./InstanceHandler":16,"./LayerStateHandler":17,"./ReferenceHandler":18,"./lib/event":25,"./lib/expression":26,"./lib/instance":27,"./lib/lib":28,"./lib/performance":29,"./lib/reference":30,"./lib/timeline":31}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResolverHandler=void 0;const r=e("./ResolvedTimelineHandler"),i=e("../api/resolvedTimeline"),s=e("./lib/lib"),o=e("./lib/performance"),a=e("./lib/timeline"),l=e("./TimelineValidator");function c(e,t){return e.time-t.time||t.type-e.type||(0,s.compareStrings)(e.objId,t.objId)}n.ResolverHandler=class{constructor(e){this.options=e,this.hasRun=!1,this.nextEvents=[];const t=(0,o.tic)("new Resolver");this.resolvedTimeline=new r.ResolvedTimelineHandler(this.options),this.validator=new l.TimelineValidator,t()}resolveTimeline(e){const t=(0,o.tic)("resolveTimeline");if(this.hasRun)throw new Error("Resolver.resolveTimeline can only run once per instance!\nUsage:\nconst resolver = new Resolver(options);\nresolver.run(timeline);");this.hasRun=!0,this.options.skipValidation||this.validator.validateTimeline(e,!1);for(const t of e)this.resolvedTimeline.addTimelineObject(t);let n;this.options.cache&&(n=this.resolvedTimeline.initializeCache(this.options.cache),n.determineChangedObjects()),this.resolvedTimeline.resolveAllTimelineObjs(),this.updateNextEvents(),n&&n.persistData();const r=(0,s.literal)({objects:(0,s.mapToObject)(this.resolvedTimeline.objectsMap),classes:(0,s.mapToObject)(this.resolvedTimeline.classesMap),layers:(0,s.mapToObject)(this.resolvedTimeline.layersMap),nextEvents:this.nextEvents,statistics:this.resolvedTimeline.getStatistics(),error:this.resolvedTimeline.resolveError});return t(),r}updateNextEvents(){const e=(0,o.tic)("  updateNextEvents");this.nextEvents=[];const t=[],n=[];for(const e of this.resolvedTimeline.objectsMap.values())e.resolved.isKeyframe?n.push(e):t.push(e);const r=n.length>0,s=new Set,l=new Set;for(const e of[...t,...n]){if(e.resolved.isKeyframe){if(void 0!==e.resolved.parentId){const t=this.resolvedTimeline.getObject(e.resolved.parentId);if(t&&!(0,a.objHasLayer)(t))continue}}else if(!(0,a.objHasLayer)(e))continue;for(let t=0;t<e.resolved.instances.length;t++){const n=e.resolved.instances[t];if(n.start>this.options.time&&n.start<(this.options.limitTime??1/0)){let t=!0;r&&(e.resolved.isKeyframe?s.has(`${e.resolved.parentId}_${n.start}`)&&(t=!1):s.add(`${e.id}_${n.start}`)),t&&this.nextEvents.push({objId:e.id,type:e.resolved.isKeyframe?i.EventType.KEYFRAME:i.EventType.START,time:n.start})}if(null!==n.end&&n.end>this.options.time&&n.end<(this.options.limitTime??1/0)){let t=!0;r&&(e.resolved.isKeyframe?l.has(`${e.resolved.parentId}_${n.end}`)&&(t=!1):l.add(`${e.id}_${n.end}`)),t&&this.nextEvents.push({objId:e.id,type:e.resolved.isKeyframe?i.EventType.KEYFRAME:i.EventType.END,time:n.end})}}}this.nextEvents.sort(c),e()}}},{"../api/resolvedTimeline":8,"./ResolvedTimelineHandler":19,"./TimelineValidator":22,"./lib/lib":28,"./lib/performance":29,"./lib/timeline":31}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StateHandler=void 0;const r=e("./lib/instance"),i=e("./lib/lib"),s=e("./lib/performance"),o=e("./lib/timeline");class a{getState(e,t,n=0){const l=(0,s.tic)("getState"),c={time:t,layers:{},nextEvents:e.nextEvents.filter((e=>e.time>t))};n&&(c.nextEvents=c.nextEvents.slice(0,n));for(const n of Object.values(e.objects))if((0,o.objHasLayer)(n))for(const s of n.resolved.instances)if((0,r.instanceIsActive)(s,t)){let r=!0;const o={...n,instance:s};if(c.layers[`${n.layer}`])throw console.error(c.layers[`${n.layer}`]),console.error(o),new Error(`Internal Error: There is already an object on layer "${n.layer}"!`);c.layers[`${n.layer}`]=o;const l=n.keyframes?n.keyframes.map((t=>e.objects[t.id])):[];for(const e of this.getActiveKeyframeInstances(l,t))r&&(o.content=(0,i.clone)(n.content),r=!1),a.applyKeyframeContent(o.content,e.content)}return l(),c}static applyKeyframeContent(e,t){const n=(0,s.tic)("  applyKeyframeContent");for(const[n,r]of Object.entries(t))(0,i.isObject)(r)?(0,i.isArray)(r)?(Array.isArray(e[n])||(e[n]=[]),this.applyKeyframeContent(e[n],r),e[n].splice(r.length,1/0)):((0,i.isObject)(e[n])&&!Array.isArray(e[n])||(e[n]={}),this.applyKeyframeContent(e[n],r)):e[n]=r;n()}getActiveKeyframeInstances(e,t){const n=[];for(const i of e)for(const e of i.resolved.instances)(0,r.instanceIsActive)(e,t)&&n.push({...i,instance:e});return n.sort(((e,t)=>{const n=e.priority??0,r=t.priority??0;return n<r?-1:n>r?1:e.instance.start<t.instance.start?-1:e.instance.start>t.instance.start?1:0})),n}}n.StateHandler=a},{"./lib/instance":27,"./lib/lib":28,"./lib/performance":29,"./lib/timeline":31}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TimelineValidator=void 0;const r=e("./ExpressionHandler"),i=e("./lib/lib"),s=e("./lib/performance"),o=/[#.$]/g,a=/[=?@{}[\]^]/g;class l{constructor(){this.uniqueIds={}}validateTimeline(e,t){const n=(0,s.tic)("  validateTimeline");for(let n=0;n<e.length;n++){const r=e[n];this.validateObject(r,t)}n()}validateObject(e,t){if(!e)throw new Error("Object is undefined");if("object"!=typeof e)throw new Error("Object is not an object");try{if(this.validateId(e,t),this.validateLayer(e,t),this.validateContent(e),this.validateEnable(e,t),e.keyframes)for(let n=0;n<e.keyframes.length;n++){const r=e.keyframes[n];try{this.validateKeyframe(r,t)}catch(e){throw new Error(`Keyframe[${n}]: ${e}`)}}if(this.validateClasses(e,t),e.children&&!e.isGroup)throw new Error('Attribute "children" is set but "isGroup" is not');if(e.isGroup&&!e.children)throw new Error('Attribute "isGroup" is set but "children" missing');if(e.children)for(let n=0;n<e.children.length;n++){const r=e.children[n];try{this.validateObject(r,t)}catch(e){throw new Error(`Child[${n}]: ${e}`)}}if(void 0!==e.priority&&"number"!=typeof e.priority)throw new Error('Attribute "priority" is not a number')}catch(t){if(t instanceof Error){throw new Error(`Object "${e.id}": ${t.message}`).stack=t.stack,t}throw t}}validateKeyframe(e,t){if(!e)throw new Error("Keyframe is undefined");if("object"!=typeof e)throw new Error("Keyframe is not an object");try{this.validateId(e,t),this.validateContent(e),this.validateEnable(e,t),this.validateClasses(e,t)}catch(t){if(t instanceof Error){throw new Error(`Keyframe "${e.id}": ${t.message}`).stack=t.stack,t}throw t}}validateId(e,t){if(!e.id)throw new Error('Object missing "id" attribute');if("string"!=typeof e.id)throw new Error(`Object "id" attribute is not a string: "${e.id}"`);try{l.validateReferenceString(e.id,t)}catch(e){throw new Error(`Object "id" attribute: ${e}`)}if(this.uniqueIds[e.id])throw new Error(`id "${e.id}" is not unique`);this.uniqueIds[e.id]=!0}validateLayer(e,t){if(void 0===e.layer)throw new Error('"layer" attribute is undefined. (If an object is to have no layer, set this to an empty string.)');try{l.validateReferenceString(`${e.layer}`,t)}catch(e){throw new Error(`"layer" attribute: ${e}`)}}validateContent(e){if(!e.content)throw new Error('"content" attribute must be set')}validateEnable(e,t){if(!e.enable)throw new Error('"enable" attribute must be set');const n=(0,i.ensureArray)(e.enable);for(let e=0;e<n.length;e++){const r=n[e];if(void 0!==r.start){if(t&&void 0!==r.while)throw new Error('"enable.start" and "enable.while" cannot be combined');if(t&&void 0!==r.end&&void 0!==r.duration)throw new Error('"enable.end" and "enable.duration" cannot be combined')}else{if(void 0===r.while)throw new Error('"enable.start" or "enable.while" must be set');if(t&&void 0!==r.end)throw new Error('"enable.while" and "enable.end" cannot be combined');if(t&&void 0!==r.duration)throw new Error('"enable.while" and "enable.duration" cannot be combined')}}}validateClasses(e,t){if(e.classes)for(let n=0;n<e.classes.length;n++){const r=e.classes[n];if(r&&"string"!=typeof r)throw new Error(`"classes[${n}]" is not a string`);try{l.validateReferenceString(r,t)}catch(e){throw new Error(` "classes[${n}]": ${e}`)}}}static validateReferenceString(e,t){if(!e)return;const n=r.REGEXP_OPERATORS.test(e),i=o.test(e),s=t&&a.test(e);if(n||i||s){const n=e.match(r.REGEXP_OPERATORS)??[],i=e.match(o)??[],s=t&&e.match(a)||[];throw new Error(`The string "${e}" contains characters which aren't allowed in Timeline: ${[n.length>0&&`${n.map((e=>`"${e}"`)).join(", ")} (is an operator)`,i.length>0&&`${i.map((e=>`"${e}"`)).join(", ")} (is a reserved character)`,s.length>0&&`${s.map((e=>`"${e}"`)).join(", ")} (is a strict reserved character and might be used in the future)`].filter(Boolean).join(", ")}`)}}}n.TimelineValidator=l},{"./ExpressionHandler":15,"./lib/lib":28,"./lib/performance":29}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;n.Cache=class{constructor(e=!1){this.autoCleanup=e,this.cache=new Map,this.clearTimeout=void 0,this.timeToCueNewCleanup=!1,this.autoCleanup&&(this.timeToCueNewCleanup=!0)}cacheResult(e,t,n){const r=this.cache.get(e);if(!r||r.ttl<Date.now()){const r=t();return this.cache.set(e,{ttl:Date.now()+n,value:r}),this.timeToCueNewCleanup&&(this.timeToCueNewCleanup=!1,this.clearTimeout=setTimeout((()=>{this.clearTimeout=void 0,this.timeToCueNewCleanup=!0,this.cleanUp()}),n+100)),r}return r.value}cleanUp(){const e=Date.now();for(const[t,n]of this.cache.entries())n.ttl<e&&this.cache.delete(t)}clear(){this.cache.clear(),this.clearTimeout&&(clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.timeToCueNewCleanup=!0)}}},{}],24:[function(e,t,n){"use strict";function r(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];if(r)for(let e=0;e<r.length;e++){const n=r[e];t[n.id]=n}}return Object.values(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.addCapsToResuming=n.joinCaps=void 0,n.joinCaps=r,n.addCapsToResuming=function(e,...t){const n=[],i=r(...t);for(let t=0;t<i.length;t++){const r=i[t];null!==r.end&&null!==e.end&&r.end>e.end&&n.push({id:r.id,start:0,end:r.end})}e.caps=r(e.caps,n)}},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.sortEvents=void 0,n.sortEvents=function(e,t){return e.sort(((e,n)=>{if(e.time>n.time)return 1;if(e.time<n.time)return-1;const r=t?t(e,n):0;if(0!==r)return r;const i=e.data&&(e.data.id||e.data.instance?.id),s=n.data&&(n.data.id||n.data.instance?.id);if(i&&s&&i===s){if(e.value&&!n.value)return-1;if(!e.value&&n.value)return 1}else{if(e.value&&!n.value)return 1;if(!e.value&&n.value)return-1}return 0}))}},{}],26:[function(e,t,n){"use strict";function r(e){return null!==e&&("number"==typeof e||"string"==typeof e&&(!!/^[-+]?[0-9.]+$/.exec(e)&&!isNaN(parseFloat(e))))}Object.defineProperty(n,"__esModule",{value:!0}),n.isNumericExpr=n.isConstantExpr=void 0,n.isConstantExpr=function(e){if(r(e))return!0;if("string"==typeof e){const t=e.toLowerCase();if("true"===t)return!0;if("false"===t)return!0}return!1},n.isNumericExpr=r},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getInstanceHash=n.getInstancesHash=n.baseInstance=n.baseInstances=n.spliceInstances=n.getInstanceIntersection=n.instanceIsActive=n.isInstanceId=void 0;const r=e("./lib");function i(e){return{start:e.start,end:e.end}}function s(e){const t=e.originalStart??e.start,n=e.originalEnd??e.end;return`${e.start}_${e.end??"null"}(${t}_${n??"null"})`}n.isInstanceId=function(e){return e.startsWith("@")},n.instanceIsActive=function(e,t){return e.start<=t&&(e.end??1/0)>t},n.getInstanceIntersection=function(e,t){if(e.start<(t.end??1/0)&&(e.end??1/0)>t.start){const n=Math.max(e.start,t.start),r=Math.min(e.end??1/0,t.end??1/0);return{start:n,end:r===1/0?null:r}}return null},n.spliceInstances=function(e,t){for(let n=0;n<e.length;n++){const i=t(e[n]),s=void 0===i?[]:(0,r.ensureArray)(i);if(0===s.length)e.splice(n,1),n--;else{if(s[0]===e[n])continue;e.splice(n,1,...s),n+=s.length-1}}},n.baseInstances=function(e){return e.map((e=>i(e)))},n.baseInstance=i,n.getInstancesHash=function(e){const t=[];for(const n of e)t.push(s(n));return t.join(",")},n.getInstanceHash=s},{"./lib":28}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.compareStrings=n.mapToObject=n.assertNever=n.isArray=n.ensureArray=n.isEmpty=n.sortBy=n.omit=n.uniq=n.clone=n.pushToArray=n.reduceObj=n.isObject=n.last=n.compact=n.literal=void 0,n.literal=function(e){return e},n.compact=function(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];(r||null!=r&&""!==r)&&t.push(r)}return t},n.last=function(e){return e[e.length-1]},n.isObject=function(e){return null!==e&&"object"==typeof e},n.reduceObj=function(e,t,n){return Object.entries(e).reduce(((e,[n,r],i)=>t(e,r,n,i)),n)},n.pushToArray=function(e,t){for(const n of t)e.push(n)},n.clone=function(e){return JSON.parse(JSON.stringify(e))},n.uniq=function(e){return Array.from(new Set(e))},n.omit=function(e,...t){const n={};for(const[r,i]of Object.entries(e))t.some((e=>Array.isArray(e)?e.includes(r):e===r))||(n[r]=i);return n},n.sortBy=function(e,t){const n=e.map((e=>({item:e,value:t(e)})));return n.sort(((e,t)=>e.value<t.value?-1:e.value>t.value?1:0)),n.map((e=>e.item))},n.isEmpty=function(e){return 0===Object.keys(e).length},n.ensureArray=function(e){return Array.isArray(e)?e:[e]},n.isArray=function(e){return void 0!==e.length&&Array.isArray(e)},n.assertNever=function(e){},n.mapToObject=function(e){const t={};for(const[n,r]of e.entries())t[n]=r;return t},n.compareStrings=function(e,t){return e>t?1:e<t?-1:0}},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ticTocPrint=n.tic=n.activatePerformanceDebugging=void 0;const r=e("perf_hooks");let i={},s={},o=0,a=!1;function l(){}function c(e,t){for(;e.length<t;)e+=" ";return e}n.activatePerformanceDebugging=function(e){a=e},n.tic=function(e){if(!a)return l;o||(o=r.performance.now()),i[e]||(i[e]=0),s[e]||(s[e]=0);const t=r.performance.now();return()=>{const n=r.performance.now()-t;i[e]=i[e]+n,s[e]++}},n.ticTocPrint=function(){if(!a)return;const e=r.performance.now()-o,t=Math.max(...Object.keys(i).map((e=>e.length)));console.log("ticTocPrint\n"+c("Total duration ",t+2)+`${Math.floor(e)}\n`+Object.entries(i).map((n=>{let r=c(`${n[0]} `,t+2);return r+=c(""+Math.floor(10*n[1])/10,8),r+=c(Math.floor(n[1]/e*1e3)/10+"%",7),r+=`${s[n[0]]}`,r})).join("\n")),i={},s={}}},{perf_hooks:3}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isReference=n.joinReferences=n.getRefInstanceId=n.isInstanceReference=n.getRefLayer=n.isLayerReference=n.getRefClass=n.isClassReference=n.getRefObjectId=n.isObjectReference=void 0;const r=e("./lib"),i=e("./performance");n.isObjectReference=function(e){return e.startsWith("#")},n.getRefObjectId=function(e){return e.slice(1)},n.isClassReference=function(e){return e.startsWith(".")},n.getRefClass=function(e){return e.slice(1)},n.isLayerReference=function(e){return e.startsWith("$")},n.getRefLayer=function(e){return e.slice(1)},n.isInstanceReference=function(e){return e.startsWith("@")},n.getRefInstanceId=function(e){return e.slice(1)},n.joinReferences=function(e,...t){const n=(0,i.tic)("     joinReferences");if(1===t.length&&"string"!=typeof t[0]&&0===t[0].length)return[...e];let s=!1,o=[];if(1===t.length&&"string"==typeof t[0]){if(e.includes(t[0]))return[...e];o=[...e],o.push(t[0]),s=!0}if(!s){const n=new Set;for(const t of e)n.has(t)||(n.add(t),o.push(t));for(const e of t)if("string"==typeof e)n.has(e)||(n.add(e),o.push(e));else for(const t of e)n.has(t)||(n.add(t),o.push(t))}return o.sort(r.compareStrings),n(),o},n.isReference=function(e){return null!==e&&"number"==typeof e.value}},{"./lib":28,"./performance":29}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.objHasLayer=void 0,n.objHasLayer=function(e){return void 0!==e.layer&&""!==e.layer&&null!==e.layer}},{}],32:[function(e,t,n){(function(e){(function(){var n,r,i,s,o,a,l,c,u,f,d,h,p,v,b,y,m,_,g,w,j,O,T,E,R,I,x,S,P,C,$;!function(n){var r="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==r&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(n,r){return e[n]=t?t(n,r):r}}"object"==typeof t&&"object"==typeof t.exports?n(i(r,i(t.exports))):n(i(r))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])};n=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},s=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},o=function(e,t){return function(n,r){t(n,r,e)}},a=function(e,t,n,r,i,s){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,f=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),d=!1,h=n.length-1;h>=0;h--){var p={};for(var v in r)p[v]="access"===v?{}:r[v];for(var v in r.access)p.access[v]=r.access[v];p.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(e||null))};var b=(0,n[h])("accessor"===l?{get:f.get,set:f.set}:f[c],p);if("accessor"===l){if(void 0===b)continue;if(null===b||"object"!=typeof b)throw new TypeError("Object expected");(a=o(b.get))&&(f.get=a),(a=o(b.set))&&(f.set=a),(a=o(b.init))&&i.unshift(a)}else(a=o(b))&&("field"===l?i.unshift(a):f[c]=a)}u&&Object.defineProperty(u,r.name,f),d=!0},l=function(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0},c=function(e){return"symbol"==typeof e?e:"".concat(e)},u=function(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},p=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||P(t,e,n)},P=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},v=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},b=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},y=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e},m=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r},_=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},w=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof g?Promise.resolve(n.value.v).then(l,c):u(s[0][2],n)}catch(e){u(s[0][3],e)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},j=function(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:g(e[r](t)),done:!1}:i?i(t):t}:i}},O=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=v(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},T=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var A=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&P(t,e,n);return A(t,e),t},R=function(e){return e&&e.__esModule?e:{default:e}},I=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},x=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n},S=function(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)},C=function(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose]}if("function"!=typeof r)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t};var M="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};$=function(e){function t(t){e.error=e.hasError?new M(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var r=e.stack.pop();try{var i=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(i).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()},e("__extends",n),e("__assign",r),e("__rest",i),e("__decorate",s),e("__param",o),e("__esDecorate",a),e("__runInitializers",l),e("__propKey",c),e("__setFunctionName",u),e("__metadata",f),e("__awaiter",d),e("__generator",h),e("__exportStar",p),e("__createBinding",P),e("__values",v),e("__read",b),e("__spread",y),e("__spreadArrays",m),e("__spreadArray",_),e("__await",g),e("__asyncGenerator",w),e("__asyncDelegator",j),e("__asyncValues",O),e("__makeTemplateObject",T),e("__importStar",E),e("__importDefault",R),e("__classPrivateFieldGet",I),e("__classPrivateFieldSet",x),e("__classPrivateFieldIn",S),e("__addDisposableResource",C),e("__disposeResources",$)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(e,t,n){(function(e){(function(){
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var n,r,i,s,o,a,l,c,u,f,d,h,p,v,b,y,m,_,g,w,j,O,T;!function(n){var r="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:{};function i(e,t){return e!==r&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(n,r){return e[n]=t?t(n,r):r}}"object"==typeof t&&"object"==typeof t.exports?n(i(r,i(t.exports))):n(i(r))}((function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};n=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},s=function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},o=function(e,t){return function(n,r){t(n,r,e)}},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},T=function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},u=function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])},f=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o},h=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e},p=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r},v=function(e){return this instanceof v?(this.v=e,this):new v(e)},b=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof v?Promise.resolve(n.value.v).then(l,c):u(s[0][2],n)}catch(e){u(s[0][3],e)}var n}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},y=function(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:v(e[r](t)),done:"return"===r}:i?i(t):t}:i}},m=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},_=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},w=function(e){return e&&e.__esModule?e:{default:e}},j=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},O=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},e("__extends",n),e("__assign",r),e("__rest",i),e("__decorate",s),e("__param",o),e("__metadata",a),e("__awaiter",l),e("__generator",c),e("__exportStar",u),e("__createBinding",T),e("__values",f),e("__read",d),e("__spread",h),e("__spreadArrays",p),e("__await",v),e("__asyncGenerator",b),e("__asyncDelegator",y),e("__asyncValues",m),e("__makeTemplateObject",_),e("__importStar",g),e("__importDefault",w),e("__classPrivateFieldGet",j),e("__classPrivateFieldSet",O)}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}));
//# sourceMappingURL=timeline-visualizer.min.js.map
